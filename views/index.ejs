<!DOCTYPE html>
<html>

<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge'>
	<title>My Whatsapp</title>
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/sweetalert2/css/sweetalert2.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta name="viewport" content="width=device-width, user-scalable=no" />
	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="/bootstrap/css/bootstrap.min.css">
	<link
		href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
		rel="stylesheet">
</head>

<body>
	<div class="container">
		<div class="text-center">
			<h4>My Whatsapp</h4>
			<!--Grid row-->
			<div class="row justify-content-center align-items-center">
				<div class="col-md-6 text-center mx-auto">
					<form class="form-horizontal">
						<div class="form-group">
							<div class="textOnInput">
								<label for="session">Session Name:</label>
								<input type="text" class="form-control" id="session" name="session"
									placeholder="Nome para identificação da sessão">
							</div>
						</div>

						<div class="form-group">
							<button type="button" class="btn btn-primary" id="send-btn" name="send-btn"
								onclick="alterSession(document.getElementById('session').value)">Iniciar</button>
						</div>
					</form>
				</div>
				<div class="col-md-6 text-center mx-auto">
					<img class="img-fluid" id="image" src="/imagens/readqrcode.jpg" draggable="false" alt="qr-code">
				</div>
			</div>
		</div>
	</div>
	</div>
	<!-- jQuery primeiro, depois Popper.js, depois Bootstrap JS -->
	<script src="/jquery/jquery-3.6.0.min.js"></script>
	<script src="/bootstrap/js/bootstrap.bundle.min.js"></script>
	<script src="/bootstrap/js/bootstrap.min.js"></script>
	<!-- JavaScript (Opcional) -->
	<script src="/sweetalert2/js/sweetalert2.min.js"></script>
	<script src="/axios/axios.min.js"></script>
	<script src="/socket/socket.io.js"></script>
	<script>

		let url;
		let host = '<%=host %>';
		let host_ssl = '<%=host_ssl %>';
		let port = '<%=port %>';
		url = host_ssl == '' ? `http://${host}:${port}` : `https://${host_ssl}`;
		const socket = io(url + '/', { transports: ['websocket'] });
		//
		socket.on('qrCode', (qrCode) => {
			let session = document.getElementById('session').value;
			if (session === qrCode.session) {
				document.getElementById('image').src = qrCode.data;
			}
		});
		//
		socket.on('whatsapp-status', (status) => {
			if (status) {
				Swal.fire({
					icon: 'success',
					title: 'Sucesso',
					text: 'Whatsapp Aberto com sucesso'
				});
			} else {

			}
		});
	</script>
</body>

</html>